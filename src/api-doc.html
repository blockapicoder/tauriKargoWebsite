<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Documentation OpenAPI</title>
    <meta name="description" content="Affiche api-doc.json (OpenAPI) avec Redoc" />
    <style>
      /* --- Dark mode --- */
      :root{
        --bg:#0b1020;
        --ink:#e5e7eb;
        --muted:#9ca3af;
        --panel:#0f172a;
        --border:#1f2937;
        --chip:#111827;
        --chip-active:#1f2937;
        --accent:#93c5fd;
      }
      html,body{height:100%;margin:0;background:var(--bg);color:var(--ink)}
      body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";}
      #loading{padding:16px;color:var(--muted)}
      .topbar{
        position:fixed;inset:0 0 auto 0;height:48px;display:flex;align-items:center;gap:12px;
        padding:0 12px;border-bottom:1px solid var(--border);background:var(--bg);z-index:10
      }
      .topbar h1{font-size:16px;margin:0;font-weight:600}
      .topbar small{color:var(--muted)}
      .container{position:absolute;inset:48px 0 0 0;background:var(--panel)}
      .btn{
        appearance:none;border:1px solid #374151;border-radius:8px;padding:6px 10px;
        background:#111827;cursor:pointer;text-decoration:none;color:var(--ink);
        display:inline-flex;align-items:center;gap:6px
      }
      .btn:active{transform:translateY(1px)}
      code{background:#0b1220;border:1px solid var(--border);border-radius:6px;padding:0 .25rem}

      /* ---------- Correctifs Redoc dark ---------- */

      /* 1) Onglets (ex: Payload, Responses, etc.) */
      #redoc [role="tablist"]{ gap:.5rem; }
      #redoc [role="tab"]{
        background:var(--chip);
        color:var(--ink);
        border:1px solid var(--border);
        border-radius:8px;
        padding:.35rem .6rem;
      }
      #redoc [role="tab"][aria-selected="true"]{
        background:var(--chip-active);
        color:var(--accent);
        border-color:#2b3b4f;
      }

      /* 2) Badges/étiquettes (tags, verbes HTTP, labels divers) */
      #redoc .http-verb,
      #redoc .operation-type,
      #redoc .label,
      #redoc span[class*="badge"],
      #redoc span[class*="Tag"],
      #redoc span[class*="Label"]{
        background:var(--chip) !important;
        color:var(--ink) !important;
        border:1px solid var(--border) !important;
        border-radius:999px !important;
        padding:.15rem .5rem !important;
      }

      /* 3) Boutons Redoc (copy, expand, etc.) */
      #redoc button{
        background:var(--chip);
        color:var(--ink);
        border:1px solid var(--border);
        border-radius:8px;
      }
      #redoc a{ color:var(--accent); }
    </style>
  </head>
  <body>
    <div class="topbar">
      <a href="index.html" class="btn" title="Retour à l’accueil">← Retour</a>
      <h1>Documentation API</h1>
      <small>Source&nbsp;: <code>./api-doc.json</code></small>
      <button id="reload" class="btn" title="Recharger la spécification">Recharger</button>
    </div>

    <div class="container">
      <div id="loading">Chargement de la doc depuis <code>api-doc.json</code>…</div>
      <div id="redoc"></div>
    </div>

    <!-- Redoc -->
    <script src="https://cdn.jsdelivr.net/npm/redoc@next/bundles/redoc.standalone.js"></script>
    <script>
      const REDOC_OPTIONS = {
        lazyRendering: true,
        hideDownloadButton: false,
        pathInMiddlePanel: true,
        expandResponses: "200,201,400,404,500",
        theme: {
          colors: {
            primary: { main: '#93c5fd' },
            text: { primary: '#e5e7eb', secondary: '#9ca3af' },
            http: { get:'#22c55e', post:'#60a5fa', put:'#f59e0b', delete:'#ef4444' },
            error:{ main:'#ef4444' }
          },
          sidebar: { backgroundColor: '#0b1020', textColor:'#e5e7eb' },
          rightPanel: { backgroundColor: '#0f172a', width: '40%' },
          codeBlock: { backgroundColor:'#0b1220' },
          schema: { labelsTextColor: '#cbd5e1' },
          typography: {
            fontSize: '14px',
            lineHeight: '1.6',
            fontFamily: 'system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial',
            headings: { fontFamily: 'inherit', fontWeight: '600', color: '#e5e7eb' }
          },
          menu: {
            backgroundColor:'#0b1020',
            textColor:'#e5e7eb',
            groupItems:'none',
            arrow:{ color:'#9ca3af' }
          }
        }
      };

      const loading = document.getElementById('loading');
      const mountEl = document.getElementById('redoc');

      async function probeAndRender(url){
        loading.style.display = 'block';
        try {
          const res = await fetch(url, { cache:'no-store' });
          if (!res.ok) throw new Error('HTTP '+res.status);
          const ctype = (res.headers.get('content-type')||'').toLowerCase();
          if (ctype.includes('json')) {
            const spec = await res.json();
            Redoc.init(spec, REDOC_OPTIONS, mountEl, ()=> loading.style.display='none');
          } else {
            Redoc.init(url, REDOC_OPTIONS, mountEl, ()=> loading.style.display='none');
          }
        } catch(e){
          Redoc.init(url, REDOC_OPTIONS, mountEl, ()=> {
            loading.innerHTML = '⚠️ Impossible de précharger <code>api-doc.json</code>. Redoc tente un chargement direct.';
            setTimeout(()=>loading.style.display='none', 1200);
          });
        }
      }

      document.getElementById('reload').addEventListener('click', ()=>location.reload());
      const url = new URL(location.href);
      const specUrl = url.searchParams.get('spec') || 'api-doc.json';
      probeAndRender(specUrl);
    </script>
  </body>
</html>
