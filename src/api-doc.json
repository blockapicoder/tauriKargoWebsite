{
  "openapi": "3.0.3",
  "info": {
    "title": "Tauri Static Server API",
    "description": "API exposed by the Axum/Tauri application (embed management, configuration, files, process execution, explorer, child servers).\n\n**Note**: some routes use POST even for reads (e.g. `/api/file/{file}`) by server design.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://127.0.0.1:{port}",
      "variables": {
        "port": { "default": "8080", "description": "Local server port" }
      }
    }
  ],
  "tags": [
    { "name": "Embed" },
    { "name": "Config" },
    { "name": "Files" },
    { "name": "Run" },
    { "name": "Explorer" },
    { "name": "Servers" },
    { "name": "Admin" }
  ],
  "paths": {
    "/api/embed": {
      "post": {
        "tags": ["Embed"],
        "summary": "Package two folders into a single executable",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/EmbedReqAny" },
              "example": {
                "code": "C:/projets/monapp/code",
                "executable": "C:/projets/monapp/executable",
                "output": "C:/projets/monapp/MonApp.exe"
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Success", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/EmbedResp" } } } },
          "400": { "description": "Invalid request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/EmbedResp" } } } },
          "500": { "description": "Internal error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/EmbedResp" } } } }
        }
      }
    },
    "/api/useConfig": {
      "post": {
        "tags": ["Config"],
        "summary": "Change root folders (code & executable",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UseConfigReq" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UseConfigResp" } } } }, "400": { "description": "Invalid folders", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UseConfigResp" } } } } }
      }
    },
    "/api/get-config": {
      "post": {
        "tags": ["Config"],
        "summary": "Get current configuration",
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/GetConfigResp" } } } } }
      }
    },
    "/api/current-directory": {
      "post": {
        "tags": ["Files"],
        "summary": "Set base directory for file operations",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CurrentDirReq" } } } },
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CurrentDirResp" } } } },
          "400": { "description": "Not a directory", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CurrentDirResp" } } } },
          "404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CurrentDirResp" } } } }
        }
      }
    },
    "/api/file/{file}": {
      "post": {
        "tags": ["Files"],
        "summary": "Read or write a file relative to the current base",
        "parameters": [
          { "name": "file", "in": "path", "required": true, "schema": { "type": "string" }, "description": "Relative path (may contain subfolders)" }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/octet-stream": { "schema": { "type": "string", "format": "binary", "description": "If the body is non-empty ⇒ raw file write. If the body is empty ⇒ read." } },
            "text/plain; charset=utf-8": { "schema": { "type": "string", "description": "Text write (UTF-8 required). Empty body ⇒ read." } }
          }
        },
        "responses": {
          "200": {
            "description": "Successful read (returns file contents) OR successful write (JSON response)",
            "content": {
              "application/json": { "schema": { "$ref": "#/components/schemas/FileWriteResp" } },
              "application/octet-stream": { "schema": { "type": "string", "format": "binary" } },
              "text/plain": { "schema": { "type": "string" } }
            }
          },
          "400": { "description": "Invalid path / invalid text encoding", "content": { "text/plain": { "schema": { "type": "string" } } } },
          "404": { "description": "File not found (read)", "content": { "text/plain": { "schema": { "type": "string" } } } },
          "500": { "description": "Server error", "content": { "text/plain": { "schema": { "type": "string" } } } }
        }
      },
      "delete": {
        "tags": ["Files"],
        "summary": "Delete a file relative to the current base",
        "parameters": [
          { "name": "file", "in": "path", "required": true, "schema": { "type": "string" }, "description": "Relative path (may contain subfolders). Must target a file, not a directory." }
        ],
        "responses": {
          "200": { "description": "File deleted", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/FileDeleteResp" } } } },
          "400": { "description": "Invalid path or path points to a directory", "content": { "text/plain": { "schema": { "type": "string" } } } },
          "404": { "description": "File not found", "content": { "text/plain": { "schema": { "type": "string" } } } },
          "500": { "description": "Server error while deleting", "content": { "text/plain": { "schema": { "type": "string" } } } }
        }
      }
    },
    "/api/run": {
      "post": {
        "tags": ["Run"],
        "summary": "Launch an executable (in exec_root)",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RunReq" }, "examples": { "list": { "value": { "executableName": "monoutil", "arguments": ["--help"] } }, "line": { "value": { "executableName": "monoutil", "arguments": "-o \"C:/tmp/a b\" --flag" } } } } } },
        "responses": { "200": { "description": "Process started", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RunResp" } } } }, "404": { "description": "Executable not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RunResp" } } } }, "500": { "description": "Launch error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RunResp" } } } } }
      }
    },
    "/api/run/status": {
      "post": {
        "tags": ["Run"],
        "summary": "Status of a started process",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProcIdReq" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProcStatusResp" } } } }, "404": { "description": "Unknown id", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProcStatusResp" } } } }, "500": { "description": "Internal error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProcStatusResp" } } } } }
      }
    },
    "/api/run/stop": {
      "post": {
        "tags": ["Run"],
        "summary": "Kill a started process",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProcIdReq" } } } },
        "responses": { "200": { "description": "Killed or already finished", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProcStopResp" } } } }, "404": { "description": "Unknown id", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProcStopResp" } } } }, "500": { "description": "Kill failed", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProcStopResp" } } } } }
      }
    },
    "/api/run/stopAll": {
      "post": {
        "tags": ["Run"],
        "summary": "Kill all started processes",
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StopAllResp" } } } } }
      }
    },
    "/api/explorer": {
      "post": {
        "tags": ["Explorer"],
        "summary": "Explore a path (file or folder)",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExplorerReq" }, "example": { "path": "C:/Users" } } } },
        "responses": {
          "200": {
            "description": "Returns either a file or a directory",
            "content": { "application/json": { "schema": { "oneOf": [ { "$ref": "#/components/schemas/ExplorerFile" }, { "$ref": "#/components/schemas/ExplorerDirectory" } ] } } }
          },
          "404": { "description": "Not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExplorerError" } } } },
          "500": { "description": "Directory read error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ExplorerError" } } } }
        }
      }
    },
    "/api/newServer": {
      "post": {
        "tags": ["Servers"],
        "summary": "Start a child server on 127.0.0.1",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewServerReq" } } } },
        "responses": { "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewServerResp" } } } }, "400": { "description": "Invalid parameters", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewServerResp" } } } }, "500": { "description": "Startup failed", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/NewServerResp" } } } } }
      }
    },
    "/api/stop": {
      "post": {
        "tags": ["Servers"],
        "summary": "Stop a server (child or current)",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StopServerReq" }, "examples": { "stopChild": { "value": { "port": 52341 } }, "stopSelf": { "value": { } } } } } },
        "responses": { "200": { "description": "OK / already stopping", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StopServerResp" } } } }, "404": { "description": "Unknown server", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StopServerResp" } } } }, "400": { "description": "Invalid request (no port on a parent)", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StopServerResp" } } } } }
      }
    }
  },
  "components": {
    "schemas": {
      "EmbedReqAny": {
        "type": "object",
        "required": ["output"],
        "properties": {
          "code": { "type": "string", "nullable": true, "description": "Code folder to package (required server-side)" },
          "executable": { "type": "string", "nullable": true, "description": "Binary folder to package" },
          "output": { "type": "string", "description": "Path of the new executable" }
        }
      },
      "EmbedResp": {
        "type": "object",
        "properties": {
          "ok": { "type": "boolean" },
          "message": { "type": "string" }
        },
        "required": ["ok", "message"]
      },
      "UseConfigReq": { "type": "object", "required": ["code", "executable"], "properties": { "code": { "type": "string" }, "executable": { "type": "string" } } },
      "UseConfigResp": { "type": "object", "required": ["ok", "message"], "properties": { "ok": { "type": "boolean" }, "message": { "type": "string" } } },
      "GetConfigResp": { "type": "object", "required": ["ok", "code", "executable", "fileBase"], "properties": { "ok": { "type": "boolean" }, "code": { "type": "string" }, "executable": { "type": "string" }, "fileBase": { "type": "string" } } },
      "CurrentDirReq": { "type": "object", "required": ["path"], "properties": { "path": { "type": "string", "description": "Absolute or relative path. Empty ⇒ CWD." } } },
      "CurrentDirResp": { "type": "object", "required": ["ok", "message", "current"], "properties": { "ok": { "type": "boolean" }, "message": { "type": "string" }, "current": { "type": "string" } } },
      "FileWriteResp": { "type": "object", "required": ["ok", "message", "path"], "properties": { "ok": { "type": "boolean" }, "message": { "type": "string" }, "path": { "type": "string" } } },
      "FileDeleteResp": { "type": "object", "required": ["ok", "message", "path"], "properties": { "ok": { "type": "boolean" }, "message": { "type": "string" }, "path": { "type": "string" } } },
      "RunReq": { "type": "object", "required": ["executableName"], "properties": { "executableName": { "type": "string" }, "arguments": { "oneOf": [ { "type": "array", "items": { "type": "string" } }, { "type": "string" } ] } } },
      "RunResp": { "type": "object", "required": ["ok", "message"], "properties": { "ok": { "type": "boolean" }, "status": { "type": "integer", "format": "int32", "nullable": true }, "message": { "type": "string" }, "stdout": { "type": "string" }, "stderr": { "type": "string" }, "id": { "type": "integer", "format": "int64", "nullable": true }, "pid": { "type": "integer", "format": "int32", "nullable": true } } },
      "ProcIdReq": { "type": "object", "required": ["id"], "properties": { "id": { "type": "integer", "format": "int64" } } },
      "ProcStatusResp": { "type": "object", "required": ["ok", "running", "message", "stdout", "stderr"], "properties": { "ok": { "type": "boolean" }, "running": { "type": "boolean" }, "status": { "type": "integer", "format": "int32", "nullable": true }, "pid": { "type": "integer", "format": "int32", "nullable": true }, "stdout": { "type": "string" }, "stderr": { "type": "string" }, "message": { "type": "string" } } },
      "ProcStopResp": { "type": "object", "required": ["ok", "message"], "properties": { "ok": { "type": "boolean" }, "message": { "type": "string" } } },
      "StopAllResp": { "type": "object", "required": ["ok", "message"], "properties": { "ok": { "type": "boolean" }, "message": { "type": "string" } } },
      "ExplorerReq": { "type": "object", "required": ["path"], "properties": { "path": { "type": "string" } } },
      "ExplorerElement": { "type": "object", "required": ["name", "path"], "properties": { "name": { "type": "string" }, "path": { "type": "string" } } },
      "ExplorerFile": { "type": "object", "required": ["type", "path", "name"], "properties": { "type": { "type": "string", "enum": ["file"] }, "path": { "type": "string" }, "name": { "type": "string" }, "parent": { "type": "string", "nullable": true } } },
      "ExplorerDirectory": { "type": "object", "required": ["type", "path", "content"], "properties": { "type": { "type": "string", "enum": ["directory"] }, "path": { "type": "string" }, "parent": { "type": "string", "nullable": true }, "content": { "type": "array", "items": { "$ref": "#/components/schemas/ExplorerElement" } } } },
      "ExplorerError": { "type": "object", "required": ["type", "message"], "properties": { "type": { "type": "string", "enum": ["error"] }, "message": { "type": "string" } } },
      "NewServerReq": { "type": "object", "required": ["code", "executable"], "properties": { "code": { "type": "string" }, "executable": { "type": "string" }, "port": { "type": "integer", "format": "int32", "minimum": 0, "maximum": 65535, "nullable": true } } },
      "NewServerResp": { "type": "object", "required": ["ok", "message"], "properties": { "ok": { "type": "boolean" }, "port": { "type": "integer", "format": "int32", "nullable": true }, "message": { "type": "string" } } },
      "StopServerReq": { "type": "object", "properties": { "port": { "type": "integer", "format": "int32", "nullable": true } } },
      "StopServerResp": { "type": "object", "required": ["ok", "message"], "properties": { "ok": { "type": "boolean" }, "port": { "type": "integer", "format": "int32", "nullable": true }, "message": { "type": "string" } } }
    }
  }
}
